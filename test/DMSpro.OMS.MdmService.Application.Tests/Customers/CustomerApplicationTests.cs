using System;
using System.Linq;
using Shouldly;
using System.Threading.Tasks;
using Volo.Abp.Domain.Repositories;
using Xunit;

namespace DMSpro.OMS.MdmService.Customers
{
    public class CustomersAppServiceTests : MdmServiceApplicationTestBase
    {
        private readonly ICustomersAppService _customersAppService;
        private readonly IRepository<Customer, Guid> _customerRepository;

        public CustomersAppServiceTests()
        {
            _customersAppService = GetRequiredService<ICustomersAppService>();
            _customerRepository = GetRequiredService<IRepository<Customer, Guid>>();
        }

        [Fact]
        public async Task GetAsync()
        {
            // Act
            var result = await _customersAppService.GetAsync(Guid.Parse("b01d38a2-a195-46f8-8e56-23ec001f6931"));

            // Assert
            result.ShouldNotBeNull();
            result.Id.ShouldBe(Guid.Parse("b01d38a2-a195-46f8-8e56-23ec001f6931"));
        }

        [Fact]
        public async Task CreateAsync()
        {
            // Arrange
            var input = new CustomerCreateDto
            {
                Name = "529472750fcf4a5c8a29247dbba4c0633430cef51bdd40cdb1316490efdc5d05f9765564c6414f068e1f6f6deec06c55e01538e2ab114a459a6176e68dd2febc85c308314d37423b9fd19aa68578c4a9ed18f748d6f8419187f2f5802788dd6a017fe80c9f294d33affda9b6e55c536dafad3131910248cbb97cc3d99aee3ba",
                Phone1 = "9f73d3345bd141d0bcaba65368e5d2494c0681804f174c158f",
                Phone2 = "99105fa6243544658583fa05eca328e3271b84f9240c48ca8a",
                erpCode = "75b057c9689949778e73",
                License = "ca176e017c4749d5857a3d8a73ced044d85b55ebdeb14398bc",
                TaxCode = "3bc4c52321f546489f051b91d21bf8c0608fe24197ac4998ad",
                vatName = "2ad7085c3f4147da96d9ca274b1b129eb730f9e174434033b4630082d72e5a6327f350ad20ef43f3827cfa586f9a9eb2375332c64db7424cb450009a52afbdf05905ae43ecf34403b00a71286b51aeae4df9beb5cbdd4908b2c5245a9d298398640a4fcc62ba4ea4999c45a625b08e64bf1f461e91e6477cbe80bb9e2deb3fc",
                vatAddress = "c07b5f159df64537a5edabb773ecb18a334170409b124f63a235ec68e4acdbebee8f4e3dcfa845769e5d62054c9a413d405fb87afb704805bc9e90962b47ee776f785fcc64214e3bae5a445e2f3d7d60b87b7872a1b04b21a0b39ac1b40cd2610d2fca0d62ed470ab931646223a9d4b6460add9943f5441294b93a05b96232c8836f3e48fb8e4f7f98dc90bb1260d00856bb031330c14460934b773d4d3f3f360ae39266a62442b9b9d745915f8430cff658f65c738e45a6998beb5afa3944a697dd01abb5cb47ce8768fe8bd8a728deae35065c390943dd9bbb1fc3d17d416a7ca5164a698e4563a04bf6117e095ff60e409b451c2142e2a7edf04b796d60aecbbb8e340ef74a759e97583bd835d4556f99e4983c234bb1b44cfadb92c13f8dd2c4fee0b1aa4b46b1f651ad53a5eba11d677adddae24832988c888cee3b4de86056411ea7884593a61b15651efc177c65460bf6a36446f79c355f348b2e57e4378881275ad74cb7bb7fc4c5731e3f244dd9bb7f73994f41a52dc95138107523aa944497de9143f9804f83d33705f4fd1202cd164c0f423488b48f61c16322e157278227aa404b9b9de690c4f624e1cb881c48a475cc4fb9b1e85ad93ff2be6702e9e3eeb3264b4a8adff142d3480ff68bc425d4acd548c39b5fb27a36b78c3649614ccba2044925b4b969ee8f1898d02f947512",
                Active = true,
                EffectiveDate = new DateTime(2009, 7, 26),
                EndDate = new DateTime(2011, 11, 25),
                CreditLimit = 1427188152,
                IsCompany = true,
                WarehouseId = Guid.Parse("1151f877-2e15-4f6b-8f81-3c599aea1563"),
                Street = "e3c0851ac5354a39923670783cb1c6e774b3fad196624cb6a799295a9a3b4851d4fd51faddcb4e7380e50ff845770cb4d3ab55a811d94ad080727113ea10dbad3babe55f3a844e409ec6f138c93ef325f96c05064961404788ea08874d697238522dade913354587ad8cb897977a7c9e2c1ca3650ec64b27941bd06a8360dc5",
                Address = "08914a7d38274ec9873624724e3b08da6080c875fbe8402ebb4661c8f5cd8d283c925560a9b24b00ba021d95a3265bbb1a4f09b3b4db417bb49c4c817e3310506c9ba7c293e7463083657831332aa0a5d763612bac1347868da030e43bad19946b823d8a0db6427793748e647e2239eff659986d5ca24ea59d2037aabb5206ad7321462fe14944fcb540e867bc37f575672bf90c83594f86b9695419e69e2523109c390b169a47f9b20ee6550fef814679edbc5269e74cd5b5adfa931cf3f40eed22aff667714f678e2b6f2ffa3c3b26d361036b3e3f49d1adab9755e748e3a67299b9cca78d431081750808b68adc7983dd6af76a3d48018410",
                Latitude = "d683ae013c0940da83ab52f92d0e0bbdbdaa181687614fcfac96d8347b7cd788bf444ae56f2d43e8a77e2785429adc05e5039e1eb25646d6bc57098601f519f58e883cabf60b4dc8afa335631eb54da4db8e114e6d024ceca9738c0c69502a1b9e84475b6fd54633aa2af66489560cb01ed07edfd5974608a4a5fdb8247c9b1",
                Longitude = "13081aa60b074644b7f9b7e33cffefa132ed5f8ffbd842df8a0de62ab1771f31c429e0b90228472d986c0bbb1b3617d84d76a56f45894eda87b284a7326a925620799bbc6c2b4006b9377f0a6e735322068cb3a5898342a28398a107cea0f408544d35a310d54782bd0f98e40a0ae7568f126f2cf1f641b0a6995126da51060",
                SFACustomerCode = "9a7c4a36b8b848949f92",
                LastOrderDate = new DateTime(2020, 11, 7)
            };

            // Act
            var serviceResult = await _customersAppService.CreateAsync(input);

            // Assert
            var result = await _customerRepository.FindAsync(c => c.Id == serviceResult.Id);

            result.ShouldNotBe(null);
            result.Name.ShouldBe("529472750fcf4a5c8a29247dbba4c0633430cef51bdd40cdb1316490efdc5d05f9765564c6414f068e1f6f6deec06c55e01538e2ab114a459a6176e68dd2febc85c308314d37423b9fd19aa68578c4a9ed18f748d6f8419187f2f5802788dd6a017fe80c9f294d33affda9b6e55c536dafad3131910248cbb97cc3d99aee3ba");
            result.Phone1.ShouldBe("9f73d3345bd141d0bcaba65368e5d2494c0681804f174c158f");
            result.Phone2.ShouldBe("99105fa6243544658583fa05eca328e3271b84f9240c48ca8a");
            result.erpCode.ShouldBe("75b057c9689949778e73");
            result.License.ShouldBe("ca176e017c4749d5857a3d8a73ced044d85b55ebdeb14398bc");
            result.TaxCode.ShouldBe("3bc4c52321f546489f051b91d21bf8c0608fe24197ac4998ad");
            result.vatName.ShouldBe("2ad7085c3f4147da96d9ca274b1b129eb730f9e174434033b4630082d72e5a6327f350ad20ef43f3827cfa586f9a9eb2375332c64db7424cb450009a52afbdf05905ae43ecf34403b00a71286b51aeae4df9beb5cbdd4908b2c5245a9d298398640a4fcc62ba4ea4999c45a625b08e64bf1f461e91e6477cbe80bb9e2deb3fc");
            result.vatAddress.ShouldBe("c07b5f159df64537a5edabb773ecb18a334170409b124f63a235ec68e4acdbebee8f4e3dcfa845769e5d62054c9a413d405fb87afb704805bc9e90962b47ee776f785fcc64214e3bae5a445e2f3d7d60b87b7872a1b04b21a0b39ac1b40cd2610d2fca0d62ed470ab931646223a9d4b6460add9943f5441294b93a05b96232c8836f3e48fb8e4f7f98dc90bb1260d00856bb031330c14460934b773d4d3f3f360ae39266a62442b9b9d745915f8430cff658f65c738e45a6998beb5afa3944a697dd01abb5cb47ce8768fe8bd8a728deae35065c390943dd9bbb1fc3d17d416a7ca5164a698e4563a04bf6117e095ff60e409b451c2142e2a7edf04b796d60aecbbb8e340ef74a759e97583bd835d4556f99e4983c234bb1b44cfadb92c13f8dd2c4fee0b1aa4b46b1f651ad53a5eba11d677adddae24832988c888cee3b4de86056411ea7884593a61b15651efc177c65460bf6a36446f79c355f348b2e57e4378881275ad74cb7bb7fc4c5731e3f244dd9bb7f73994f41a52dc95138107523aa944497de9143f9804f83d33705f4fd1202cd164c0f423488b48f61c16322e157278227aa404b9b9de690c4f624e1cb881c48a475cc4fb9b1e85ad93ff2be6702e9e3eeb3264b4a8adff142d3480ff68bc425d4acd548c39b5fb27a36b78c3649614ccba2044925b4b969ee8f1898d02f947512");
            result.Active.ShouldBe(true);
            result.EffectiveDate.ShouldBe(new DateTime(2009, 7, 26));
            result.EndDate.ShouldBe(new DateTime(2011, 11, 25));
            result.CreditLimit.ShouldBe(1427188152);
            result.IsCompany.ShouldBe(true);
            result.WarehouseId.ShouldBe(Guid.Parse("1151f877-2e15-4f6b-8f81-3c599aea1563"));
            result.Street.ShouldBe("e3c0851ac5354a39923670783cb1c6e774b3fad196624cb6a799295a9a3b4851d4fd51faddcb4e7380e50ff845770cb4d3ab55a811d94ad080727113ea10dbad3babe55f3a844e409ec6f138c93ef325f96c05064961404788ea08874d697238522dade913354587ad8cb897977a7c9e2c1ca3650ec64b27941bd06a8360dc5");
            result.Address.ShouldBe("08914a7d38274ec9873624724e3b08da6080c875fbe8402ebb4661c8f5cd8d283c925560a9b24b00ba021d95a3265bbb1a4f09b3b4db417bb49c4c817e3310506c9ba7c293e7463083657831332aa0a5d763612bac1347868da030e43bad19946b823d8a0db6427793748e647e2239eff659986d5ca24ea59d2037aabb5206ad7321462fe14944fcb540e867bc37f575672bf90c83594f86b9695419e69e2523109c390b169a47f9b20ee6550fef814679edbc5269e74cd5b5adfa931cf3f40eed22aff667714f678e2b6f2ffa3c3b26d361036b3e3f49d1adab9755e748e3a67299b9cca78d431081750808b68adc7983dd6af76a3d48018410");
            result.Latitude.ShouldBe("d683ae013c0940da83ab52f92d0e0bbdbdaa181687614fcfac96d8347b7cd788bf444ae56f2d43e8a77e2785429adc05e5039e1eb25646d6bc57098601f519f58e883cabf60b4dc8afa335631eb54da4db8e114e6d024ceca9738c0c69502a1b9e84475b6fd54633aa2af66489560cb01ed07edfd5974608a4a5fdb8247c9b1");
            result.Longitude.ShouldBe("13081aa60b074644b7f9b7e33cffefa132ed5f8ffbd842df8a0de62ab1771f31c429e0b90228472d986c0bbb1b3617d84d76a56f45894eda87b284a7326a925620799bbc6c2b4006b9377f0a6e735322068cb3a5898342a28398a107cea0f408544d35a310d54782bd0f98e40a0ae7568f126f2cf1f641b0a6995126da51060");
            result.SFACustomerCode.ShouldBe("9a7c4a36b8b848949f92");
            result.LastOrderDate.ShouldBe(new DateTime(2020, 11, 7));
        }

        [Fact]
        public async Task UpdateAsync()
        {
            // Arrange
            var input = new CustomerUpdateDto()
            {
                Name = "f0707a3bd90f4d4cb1de1e24cef2406849deedc3eb0b4d6b8fe2ba8a5cd94e7c7b577b981d324c79b4f212549be3269691383810d993449d8105e169c64a4d022cd7e837511b4016a9b18d17de1cd87934a443602f754baebff028ef2d88bcc3e810e59143544c77a320131ba3eb05dd3fb06fba06e749748f572e3a5dd6515",
                Phone1 = "e3610edfbe0646289adcd51c7252c4080564f9ca9a3d495094",
                Phone2 = "2d2e6ac2de064c0cbeff9c7bc12d0afa5b2786a5cb2b4973a1",
                erpCode = "63819bf75e2a4ad3b4b9",
                License = "e0f378275f1646f7ac5b407b8238d8807924b00061904fc285",
                TaxCode = "2015b45e97644c5fb52c8e11ebc2ec41797b92a65e6f4eb596",
                vatName = "7fc76f0d393645b8a4c22f75ab1ada1ac32ec13744754311b9f1a21ee58bb9ada49116fb834348d0855683c312bef877530d5e8c5b2e4dd7a55fd5f6191d4a28578553fbee4448a28180da85e51f02ac7226e27f08bf41df9c8928c5338d200181c6fd849884425782d0647822783bb9d55476a9fd28483aa1164f02dbd5669",
                vatAddress = "2d3d101003a4482186070763a8ebf7927be454fb2e934a5d8aa9421b72843a281354ecad74ec4966976f20620ecfa539953f4ad3e6c94c87b01e6f6f98cd30b7e103d0bc925344c381f3fd0140c1d456b7998e859cf44bbcb1a7c6588dc29e7fea7bda5ca0df4d73991d33eccceba714ab27f1ce2e5e446ca203488f3f520a3fdc0f8bf196c74633976498097b68d98df46cbb9b8b3d43efac799a40045ef80220e9a194f75b4422a62e10182aaf6a979f9c2f91c277436d8534578f17caed4178103e8da72f4638ba8f9ef813bf96a2d4fa456aae8248a990d6dbafc617fea9cfd802b99b2c42c380e71d2c87be7fcc3bf29023f0774b95834ebeaf522e3c5a35feb1445c824cffb011d05190c7795337da66d97ea44ddc9968dfe31e37351575e50d9052db49d2bf38992ff21b7d2b02584219a9a54b6d97fd1dfbbb9c91ef6c31794bdddd41b6ac4ca26b78dfee53b215a51261244a6d953175a798d0ee1786eecc18d7034e57bb538d87dbc631f464a57589d9c84f47acc4e2ee31331473cba9bd30e2304483963a2957365269d9cbbd9892c332445fb5bcecf4e35215e995d3a49b35f04dc5a855148a774a1390f3d3f39a5d10494dab84a72dce103e234a6d93b54a26459380e7a7b87ee5a764a44f7c834ef84f798a3ccb964b686e9f3f66d628586a425cb082f5fabb0bac9f35b5baa7",
                Active = true,
                EffectiveDate = new DateTime(2012, 9, 19),
                EndDate = new DateTime(2012, 1, 14),
                CreditLimit = 67460511,
                IsCompany = true,
                WarehouseId = Guid.Parse("92838bd0-bcfd-4cc4-b245-af28a3e63709"),
                Street = "c258b04f74c2415c93169dcfc69056775988faa6272844c18da123655d1274d2678944d3281643e39613dc567bdc1870aa286f5c699d4ef6b86ab92bd5017544b2b16559821a420abbf16212d95f3eba67831cf7d1484ecda3a78d823dc1f252cef7e9d8f9b446c09ac8e0f8a9612240c432c377b570447e95d3d563141eceb",
                Address = "de292da31597404387dcffac1629a5f2aaf5460b56d8456ebb2262cb138aa3d8d41261c367cc45c3af499b798b99e910ca75cd5882f545d0adeb65205af3dd5b8149124e9dad4c9b82eac44cb8c6b1cac2b66b30ff8c4fcdbf279ea5cf18469277d509d7c38b45bc96f763425c8b09c61006315491ce47c68be9b5c700519734f54180765f6a44d380d886914ea03f2eeec7ae8b7c314baf9a2ec8d5cdc476da451ccc8de78743f394f1a11e514b420a37df462e070441a3978a4f507f1686a0ab2762d60d784006a4e00784e4b5e0208b0753010934470696ffd5ee2ca9dc0098d4d781f5354193a50d6e0d66cfde702aeb519bc5b448938cc1",
                Latitude = "b92fcc367758403a9bd8d6bfc0e053c812964403f53043c6837b22cad3613adcf65b824306764d3ebb60439e8aaed3dd4a9431548a1a42ab94496edca4ef4e765d22b539195d483d82b5079577a2572cb1c4b95f81844751b2cf8d0db3cc6231632d44bc833b46bfa7555bf4cecc19396a780717f3f548e58bf11dcb067080b",
                Longitude = "45ede241a93944aaa40bb91fecc1f6cd4cf11e0a31a040dfb340ae11cc3d2cd64fb0a346540a4df48d5fd85e592e4f6ea59bd5760a7f4350a3ed19ca6502a5d636230de6b3824c139c2725fd88a71ff00a53672181a94ad2991f843f6c57f9fe0afee79716a7494a879aef2b756a30fa06a09fc90ac0463490f0f85254e99c1",
                SFACustomerCode = "098ec2969234407184ae",
                LastOrderDate = new DateTime(2004, 5, 10)
            };

            // Act
            var serviceResult = await _customersAppService.UpdateAsync(Guid.Parse("b01d38a2-a195-46f8-8e56-23ec001f6931"), input);

            // Assert
            var result = await _customerRepository.FindAsync(c => c.Id == serviceResult.Id);

            result.ShouldNotBe(null);
            result.Name.ShouldBe("f0707a3bd90f4d4cb1de1e24cef2406849deedc3eb0b4d6b8fe2ba8a5cd94e7c7b577b981d324c79b4f212549be3269691383810d993449d8105e169c64a4d022cd7e837511b4016a9b18d17de1cd87934a443602f754baebff028ef2d88bcc3e810e59143544c77a320131ba3eb05dd3fb06fba06e749748f572e3a5dd6515");
            result.Phone1.ShouldBe("e3610edfbe0646289adcd51c7252c4080564f9ca9a3d495094");
            result.Phone2.ShouldBe("2d2e6ac2de064c0cbeff9c7bc12d0afa5b2786a5cb2b4973a1");
            result.erpCode.ShouldBe("63819bf75e2a4ad3b4b9");
            result.License.ShouldBe("e0f378275f1646f7ac5b407b8238d8807924b00061904fc285");
            result.TaxCode.ShouldBe("2015b45e97644c5fb52c8e11ebc2ec41797b92a65e6f4eb596");
            result.vatName.ShouldBe("7fc76f0d393645b8a4c22f75ab1ada1ac32ec13744754311b9f1a21ee58bb9ada49116fb834348d0855683c312bef877530d5e8c5b2e4dd7a55fd5f6191d4a28578553fbee4448a28180da85e51f02ac7226e27f08bf41df9c8928c5338d200181c6fd849884425782d0647822783bb9d55476a9fd28483aa1164f02dbd5669");
            result.vatAddress.ShouldBe("2d3d101003a4482186070763a8ebf7927be454fb2e934a5d8aa9421b72843a281354ecad74ec4966976f20620ecfa539953f4ad3e6c94c87b01e6f6f98cd30b7e103d0bc925344c381f3fd0140c1d456b7998e859cf44bbcb1a7c6588dc29e7fea7bda5ca0df4d73991d33eccceba714ab27f1ce2e5e446ca203488f3f520a3fdc0f8bf196c74633976498097b68d98df46cbb9b8b3d43efac799a40045ef80220e9a194f75b4422a62e10182aaf6a979f9c2f91c277436d8534578f17caed4178103e8da72f4638ba8f9ef813bf96a2d4fa456aae8248a990d6dbafc617fea9cfd802b99b2c42c380e71d2c87be7fcc3bf29023f0774b95834ebeaf522e3c5a35feb1445c824cffb011d05190c7795337da66d97ea44ddc9968dfe31e37351575e50d9052db49d2bf38992ff21b7d2b02584219a9a54b6d97fd1dfbbb9c91ef6c31794bdddd41b6ac4ca26b78dfee53b215a51261244a6d953175a798d0ee1786eecc18d7034e57bb538d87dbc631f464a57589d9c84f47acc4e2ee31331473cba9bd30e2304483963a2957365269d9cbbd9892c332445fb5bcecf4e35215e995d3a49b35f04dc5a855148a774a1390f3d3f39a5d10494dab84a72dce103e234a6d93b54a26459380e7a7b87ee5a764a44f7c834ef84f798a3ccb964b686e9f3f66d628586a425cb082f5fabb0bac9f35b5baa7");
            result.Active.ShouldBe(true);
            result.EffectiveDate.ShouldBe(new DateTime(2012, 9, 19));
            result.EndDate.ShouldBe(new DateTime(2012, 1, 14));
            result.CreditLimit.ShouldBe(67460511);
            result.IsCompany.ShouldBe(true);
            result.WarehouseId.ShouldBe(Guid.Parse("92838bd0-bcfd-4cc4-b245-af28a3e63709"));
            result.Street.ShouldBe("c258b04f74c2415c93169dcfc69056775988faa6272844c18da123655d1274d2678944d3281643e39613dc567bdc1870aa286f5c699d4ef6b86ab92bd5017544b2b16559821a420abbf16212d95f3eba67831cf7d1484ecda3a78d823dc1f252cef7e9d8f9b446c09ac8e0f8a9612240c432c377b570447e95d3d563141eceb");
            result.Address.ShouldBe("de292da31597404387dcffac1629a5f2aaf5460b56d8456ebb2262cb138aa3d8d41261c367cc45c3af499b798b99e910ca75cd5882f545d0adeb65205af3dd5b8149124e9dad4c9b82eac44cb8c6b1cac2b66b30ff8c4fcdbf279ea5cf18469277d509d7c38b45bc96f763425c8b09c61006315491ce47c68be9b5c700519734f54180765f6a44d380d886914ea03f2eeec7ae8b7c314baf9a2ec8d5cdc476da451ccc8de78743f394f1a11e514b420a37df462e070441a3978a4f507f1686a0ab2762d60d784006a4e00784e4b5e0208b0753010934470696ffd5ee2ca9dc0098d4d781f5354193a50d6e0d66cfde702aeb519bc5b448938cc1");
            result.Latitude.ShouldBe("b92fcc367758403a9bd8d6bfc0e053c812964403f53043c6837b22cad3613adcf65b824306764d3ebb60439e8aaed3dd4a9431548a1a42ab94496edca4ef4e765d22b539195d483d82b5079577a2572cb1c4b95f81844751b2cf8d0db3cc6231632d44bc833b46bfa7555bf4cecc19396a780717f3f548e58bf11dcb067080b");
            result.Longitude.ShouldBe("45ede241a93944aaa40bb91fecc1f6cd4cf11e0a31a040dfb340ae11cc3d2cd64fb0a346540a4df48d5fd85e592e4f6ea59bd5760a7f4350a3ed19ca6502a5d636230de6b3824c139c2725fd88a71ff00a53672181a94ad2991f843f6c57f9fe0afee79716a7494a879aef2b756a30fa06a09fc90ac0463490f0f85254e99c1");
            result.SFACustomerCode.ShouldBe("098ec2969234407184ae");
            result.LastOrderDate.ShouldBe(new DateTime(2004, 5, 10));
        }

        [Fact]
        public async Task DeleteAsync()
        {
            // Act
            await _customersAppService.DeleteAsync(Guid.Parse("b01d38a2-a195-46f8-8e56-23ec001f6931"));

            // Assert
            var result = await _customerRepository.FindAsync(c => c.Id == Guid.Parse("b01d38a2-a195-46f8-8e56-23ec001f6931"));

            result.ShouldBeNull();
        }
    }
}